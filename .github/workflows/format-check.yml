name: Format Check

on: [pull_request, push]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          submodules: recursive
      - name: Setup Zig 0.14.1
        uses: goto-bus-stop/setup-zig@v2
        with:
          version: 0.14.1
      - name: Verify Zig installation
        run: |
          set -euo pipefail
          zig version
          which zig
      - name: Find Zig files
        run: |
          set -euo pipefail
          git ls-files '*.zig' | sed 's/^/ - /'
      - name: Check Zig formatting
        run: |
          set -euo pipefail
          files=$(git ls-files '*.zig')
          if [ -n "$files" ]; then
            echo "$files" | xargs -n 50 zig fmt --check
          else
            echo "No Zig files to check.";
          fi
